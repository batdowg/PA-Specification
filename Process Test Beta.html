<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Process Test - Kepner-Tregoe</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
      overflow-x: auto;
      min-width: 1200px;
    }
    
    .container {
      max-width: 2200px;
      width: 98%;
      margin: 0 auto;
      background-color: white;
      box-shadow: 0 3px 2px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: visible;
      border: 1px solid rgba(0,0,0,0.1);
    }
    
    .header {
      background-color: #0057B7;
      color: white;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: 5px 5px 0 0;
      width: 100%;
      box-sizing: border-box;
    }
    
    .title {
      font-size: 24px;
      font-weight: bold;
      margin: 0;
    }
    
    .kt-logo {
      font-family: 'Montserrat', 'Gotham', sans-serif;
      font-weight: 800;
      font-size: 24px;
      letter-spacing: -1px;
      background-color: white;
      padding: 2px 6px;
      border-radius: 4px;
      color: #00BFF3;
    }

    .kt-k {
      color: #00BFF3;
      font-weight: 800;
    }

    .kt-t {
      color: #007BFF;
      font-weight: 800;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      padding: 15px;
      background-color: #f0f0f0;
      border-bottom: 1px solid #ddd;
    }
    
    .sa-btn {
      padding: 10px 20px;
      background-color: #0057B7;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    
    .sa-btn:hover {
      background-color: #004494;
    }
    
    .pa-btn {
      padding: 10px 20px;
      background-color: #E03C31;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    
    .pa-btn:hover {
      background-color: #C0231B;
    }
    
    .fp-btn {
      padding: 10px 20px;
      background-color: #b2b2b2;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }

    .fp-btn:hover {
      background-color: #6b6b6b;
    }
    
    .reset-btn {
      padding: 10px 20px;
      background-color: #6c757d;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    
    .reset-btn:hover {
      background-color: #5a6268;
    }
    
    .tabs {
      display: flex;
      background-color: #f0f0f0;
      border-bottom: 1px solid #ddd;
    }
    
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      font-weight: bold;
    }
    
    #sa-tab-btn {
      color: #0057B7;
    }
    
    #pa-tab-btn {
      color: #E03C31;
    }
    
    #fp-tab-btn {
      color: #6b6b6b;
    }
    
    .tab.active#sa-tab-btn {
      background-color: white;
      border-bottom: 3px solid #0057B7;
    }
    
    .tab.active#pa-tab-btn {
      background-color: white;
      border-bottom: 3px solid #E03C31;
    }
    
    .tab.active#fp-tab-btn {
      background-color: white;
      border-bottom: 3px solid #b2b2b2;
    }
    
    .tab-content {
      display: none;
      padding: 20px;
    }
    
    .tab-content.active {
      display: flex;
    }
    
    .content-layout {
      display: flex;
      width: 100%;
      gap: 20px;
    }
    
    #fp-tab .content-layout {
      max-width: calc(100% - 10px);
      margin: 0 auto 0 0;
      padding: 0 10px 0 20px;
      box-sizing: border-box;
      overflow: visible;
    }
    
    .process-board {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .fp-columns-container {
      display: flex;
      width: 100%;
      gap: 30px;
      padding-right: 50px;
    }
    
    .fp-column {
      flex: 1;
      position: relative;
      min-width: 0;
    }
    
    .fp-column-divider {
      position: absolute;
      top: 0;
      right: -20px;
      width: 2px;
      height: 100%;
      background-color: #b2b2b2;
    }
    
    .fp-section-heading {
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 25px;
      padding: 10px;
      border-radius: 5px;
    }
    
    .fp-sa-heading {
      background-color: rgba(0, 87, 183, 0.1);
      color: #0057B7;
      border-bottom: 2px solid #0057B7;
    }
    
    .fp-pa-heading {
      background-color: rgba(224, 60, 49, 0.1);
      color: #E03C31;
      border-bottom: 2px solid #E03C31;
    }
    
    .notes-area-container {
      position: fixed;
      min-width: 325px;
      min-height: 200px;
      z-index: 50;
      background: linear-gradient(#ffffff, #f9f9f9);
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);

      border: 1px solid #ddd;

      border-radius: 5px;
      overflow: hidden;
      resize: both;
      width: 350px;
      height: 600px;
    }

    #sa-notes-container {
      top: 150px;
      right: 200px;
      border-color: #0057B7;
    }

    #pa-notes-container {
      top: 150px;
      right: 200px;
      display: none;
      border-color: #E03C31;
    }
    
    #fp-notes-container {
      height: 700px;
      width: 350px;
      min-height: 400px;
      overflow-y: auto;
      position: fixed;
      top: 150px;
      right: 200px;
      z-index: 100;
      display: none;
      border-color: #b2b2b2;
    }

    .notes-header {
      padding: 8px 10px;
      cursor: move;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
    }

    .sa-notes-header {
      background-color: #0057B7;
      color: white;
    }

    .pa-notes-header {
      background-color: #E03C31;
      color: white;
    }
    
    .fp-notes-header {
      background-color: #b2b2b2;
      color: white;
    }

    .notes-title {
      margin: 0;
      font-size: 14px;
      font-weight: bold;
    }

    .notes-header-buttons {
      display: flex;
      gap: 5px;
    }

    .notes-collapse-btn, .notes-resize-btn {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 18px;
      padding: 0;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .notes-collapse-btn:hover, .notes-resize-btn:hover {
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 3px;
    }
    
    .notes-area {
      height: calc(100% - 38px);
      overflow-y: auto;
      overflow-x: hidden;
      padding: 10px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
      align-content: start;
      box-sizing: border-box;
      background-color: #ffffff;
    }
    
    #sa-notes {
      background-color: #F8FAFD;
      border-top: 2px solid #0057B7;
      max-height: calc(100% - 38px);
      overflow-y: auto;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
      padding: 10px;
      align-content: start;
      box-sizing: border-box;
    }
    
    #pa-notes {
      background-color: #FDF8F8;
      border-top: 2px solid #E03C31;
      max-height: calc(100% - 38px);
      overflow-y: auto;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
      padding: 10px;
      align-content: start;
      box-sizing: border-box;
    }
    
    #fp-notes {
      background-color: #f2f2f2;
      border-top: 2px solid #6b6b6b;
      max-height: calc(100% - 38px);
      overflow-y: auto;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 10px;
      padding: 10px;
      align-content: start;
      box-sizing: border-box;
    }
    
    .resize-handle {
      position: absolute;
      z-index: 10;
      background-color: transparent;
    }

    .resize-handle.handle-n,
    .resize-handle.handle-s {
      left: 0;
      right: 0;
      height: 2px;
      cursor: ns-resize;
    }

    .resize-handle.handle-n { top: 0; }
    .resize-handle.handle-s { bottom: 0; }

    .resize-handle.handle-e,
    .resize-handle.handle-w {
      top: 0;
      bottom: 0;
      width: 2px;
      cursor: ew-resize;
    }

    .resize-handle.handle-e { right: 0; }
    .resize-handle.handle-w { left: 0; }

    .resize-handle.handle-ne,
    .resize-handle.handle-nw,
    .resize-handle.handle-se,
    .resize-handle.handle-sw {
      width: 6px;
      height: 6px;
    }

    .resize-handle.handle-ne { top: 0; right: 0; cursor: nesw-resize; }
    .resize-handle.handle-nw { top: 0; left: 0; cursor: nwse-resize; }
    .resize-handle.handle-se { bottom: 0; right: 0; cursor: nwse-resize; }
    .resize-handle.handle-sw { bottom: 0; left: 0; cursor: nesw-resize; }

    .sa-resize-handle { background-color: rgba(0, 87, 183, 0.3); }
    .pa-resize-handle { background-color: rgba(224, 60, 49, 0.3); }
    .fp-resize-handle { background-color: rgba(178, 178, 178, 0.3); }

    .resize-handle:hover { background-color: rgba(0,0,0,0.35); }
    .sa-resize-handle:hover { background-color: rgba(0, 68, 148, 0.5); }
    .pa-resize-handle:hover { background-color: rgba(192, 35, 27, 0.5); }
    .fp-resize-handle:hover { background-color: rgba(107, 107, 107, 0.5); }
    
    .process-row {
      display: flex;
      gap: 10px;
    }
    
    .indented {
      margin-left: 184px;
    }
    
    .box {
      width: 160px;
      height: 160px;
      border: 2px solid;
      border-radius: 0px;
      padding: 0px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      background-color: white;
      position: relative;
      box-sizing: border-box;
    }   
    
    .box[data-label*="Process Step"],
    .box[data-label*="Action Step"]:not([data-label*="Why"]):not([data-label*="Process Question"]):not([data-label*="Sub-process Element"]) {
      box-shadow: 3px 3px 8px rgba(0,0,0,1);
    }
    .sa-box {
      border-color: #0057B7;
    }
    
    .pa-box {
      border-color: #E03C31;
    }
    
    .fp-box {
      border-color: #b2b2b2;
    }
    
    .highlight {
      box-shadow: 0 0 10px rgba(0,0,0,1);
    }
    
    .note {
      width: 140px;
      height: 140px;
      border: 2px solid;
      border-radius: 0px;
      padding: 2px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      background-color: white;
      cursor: grab;
      font-size: 14px;
      align-self: center;
      margin: 2px;
      position: relative;
      box-shadow: 0 4px 6px rgba(0,0,0,0.5);
      justify-self: center;
    }
    
    .sa-note {
      border-color: #0057B7;
      background-color: #F1F7FD;
      width: 140px;
      height: 140px;
      margin: 2px;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 14px;
      overflow: hidden;
    }
    
    .pa-note {
      border-color: #E03C31;
      background-color: #FEF0EF;
      width: 140px;
      height: 140px;
      margin: 2px;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 14px;
      overflow: hidden;
    }
    
    .fp-note {
      width: 140px;
      height: 140px;
      margin: 2px;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 14px;
      overflow: hidden;
    }

    .fp-note[data-target^="SA"] {
      border-color: #0057B7;
      background-color: #F1F7FD;
    }
    
    .fp-note[data-target^="PA"] {
      border-color: #E03C31;
      background-color: #FEF0EF;
    }

    .container.hard-mode .fp-note,
    .container.hard-mode .fp-note[data-target^="SA"],
    .container.hard-mode .fp-note[data-target^="PA"] {
      border-color: #6b6b6b !important;
      background-color: #f2f2f2 !important;
    }
    .normal-mode .fp-note[data-target^="SA"] {
      border-color: #0057B7 !important;
      background-color: #F1F7FD !important;
    }
    .normal-mode .fp-note[data-target^="PA"] {
      border-color: #E03C31 !important;
      background-color: #FEF0EF !important;
    }

    .note.dragging {
      opacity: 0.5;
    }
    
    .note.correct {
      border-color: #28a745;
      background-color: #e6ffea;
    }
    
    .note.incorrect {
      border-color: #dc3545;
      background-color: #ffe6e6;
    }
    
    .score-display {
      margin: 0px;
      text-align: center;
      padding: 2px;
      background-color: #f0f0f0;
      border-radius: 1px;
      max-width: none;
      display: none;
      white-space: nowrap;
    }
    .score-display h3 {
      margin: 0;
      font-size: 16px;
    }
    .success {
      color: #28a745;
    }
    
    .partial {
      color: #fd7e14;
    }
    
    .empty {
      color: #dc3545;
    }

    .help-btn {
      padding: 10px 15px;
      background-color: #0070C0;
      color: white;
      border: 2px;
      border-radius: 50%;
      cursor: pointer;
      font-weight: bold;
      font-size: 18px;
    }

    .help-btn:hover {
      background-color: #009CDE;
    }

    .hard-mode-btn {
      padding: 6px 12px;
      background-color: #6c757d;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
      margin-right: 10px;
      transition: background-color 0.3s;
    }

    .hard-mode-btn:hover {
      background-color: #5a6268;
    }

    .hard-mode-btn.active {
      background-color: #dc3545;
    }

    .hard-mode-btn.active:hover {
      background-color: #c82333;
    }

    .demon-mode-btn {
      padding: 6px 12px;
      background-color: #6c757d;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
      margin-right: 10px;
      transition: background-color 0.3s;
    }

    .demon-mode-btn:hover {
      background-color: #5a6268;
    }

    .demon-mode-btn.active {
      background-color: #6610f2;
    }

    .demon-mode-btn.active:hover {
      background-color: #520dc2;
    }

    .container.demon-mode .note {
      font-style: normal;
      font-weight: normal;
    }

    .help-popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      z-index: 100;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .help-popup-content {
      margin-bottom: 20px;
    }
    .help-popup-content p,
    .help-popup-content li {
      font-weight: normal;
      font-size: 14px;
      line-height: 1.4;
    }
    .help-popup-content .tip {
      font-style: italic;
    }

    .help-popup-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .help-popup-header h2 {
      margin: 0;
      color: #0057B7;
    }

    .help-popup-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }

    .help-popup-close:hover {
      color: #333;
    }

    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 99;
    }

    .hint-btn {
      padding: 10px 20px;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      display: none;
    }

    .sa-hint-btn {
      background-color: #0057B7;
    }

    .sa-hint-btn:hover {
      background-color: #004494;
    }

    .pa-hint-btn {
      background-color: #E03C31;
    }

    .pa-hint-btn:hover {
      background-color: #C0231B;
    }
    
    .fp-hint-btn {
      background-color: #b2b2b2;
    }

    .fp-hint-btn:hover {
      background-color: #6b6b6b;
    }

    .box-hint {
      position: absolute;
      top: -45px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #555;
      color: white;
      padding: 8px 12px;
      border-radius: 5px;
      font-size: 12px;
      width: 120px;
      z-index: 10;
      text-align: center;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
    }

    .box-hint::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      margin-left: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: #555 transparent transparent transparent;
    }

    .box.show-hint .box-hint {
      opacity: 1;
    }
    
    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .resize-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 999;
      display: none;
      cursor: nwse-resize;
    }
  </style>
</head>
<body>
  <div id="resize-overlay" class="resize-overlay"></div>
  <div class="container">
    <div class="header">
      <h1 class="title">KT Process Test</h1>
      <div class="header-right">
        <!-- Hard Mode Button -->
        <button id="hard-mode-btn" class="hard-mode-btn">Hard Mode</button>
        <!-- Demon Mode Button -->
        <button id="demon-mode-btn" class="demon-mode-btn">Demon Mode</button>
        <button id="help-btn" class="help-btn">?</button>
        <div class="kt-logo">
          <span class="kt-k">K</span><span class="kt-t">T</span>
        </div>
      </div>
    </div>
    
    <div class="tabs">
      <div id="sa-tab-btn" class="tab active" data-tab="sa">Situation Appraisal</div>
      <div id="pa-tab-btn" class="tab" data-tab="pa">Problem Analysis</div>
      <div id="fp-tab-btn" class="tab" data-tab="fp">Full Process</div>
    </div>
    
    <div class="controls">
      <button id="submit-sa-btn" class="sa-btn" onclick="submitAnswers('sa')">Submit Answers</button>
      <button id="reset-sa-btn" class="reset-btn" onclick="resetExercise('sa')">Reset Exercise</button>
      <button id="submit-pa-btn" class="pa-btn" onclick="submitAnswers('pa')" style="display: none;">Submit Answers</button>
      <button id="reset-pa-btn" class="reset-btn" onclick="resetExercise('pa')" style="display: none;">Reset Exercise</button>
      <button id="submit-fp-btn" class="fp-btn" onclick="submitAnswers('fp')" style="display: none;">Submit Answers</button>
      <button id="reset-fp-btn" class="reset-btn" onclick="resetExercise('fp')" style="display: none;">Reset Exercise</button>
      <button id="show-hints-sa-btn" class="hint-btn sa-hint-btn" onclick="showHints('sa')" style="display: none;">Show Hints</button>
      <button id="show-hints-pa-btn" class="hint-btn pa-hint-btn" onclick="showHints('pa')" style="display: none;">Show Hints</button>
      <button id="show-hints-fp-btn" class="hint-btn fp-hint-btn" onclick="showHints('fp')" style="display: none;">Show Hints</button>
      <div id="sa-score" class="score-display">
        <h3>Score: <span id="sa-score-value">0/19</span></h3>
        <span id="sa-message"></span>
      </div>
      <div id="pa-score" class="score-display">
        <h3>Score: <span id="pa-score-value">0/30</span></h3>
        <span id="pa-message"></span>
      </div>
      <div id="fp-score" class="score-display">
        <h3>Score: <span id="fp-score-value">0/49</span></h3>
        <span id="fp-message"></span>
      </div>
    </div>
    
    <!-- Situation Appraisal Tab -->
    <div id="sa-tab" class="tab-content active">
      <div class="content-layout">
        <!-- Left side: Process board -->
        <div class="process-board">
          <!-- Process Step 1 Row -->
          <div class="process-row">
            <div class="box sa-box" data-label="SA Process Step 1">
              <b>PROCESS STEP 1</b>
            </div>
            <div class="box sa-box" data-label="SA Action Step 1.1">
              ACTION STEP 1.1
            </div>
            <div class="box sa-box" data-label="SA Action Step 1.1 Why">
              <i><b>Why?</i></b>
            </div>
            <div class="box sa-box" data-label="SA Action Step 1.1 Process Question">
              <i>Process Question</i>
            </div>
          </div>
          
          <!-- Action Step 1.2 Row -->
          <div class="process-row"" style="margin-top: -10px;">
            <div class="box sa-box" data-label="SA Action Step 1.2" style="margin-left: 170px;">
              ACTION STEP 1.2
            </div>
            <div class="box sa-box" data-label="SA Action Step 1.2 Why">
              <i><b>Why?</i></b>
            </div>
            <div class="box sa-box" data-label="SA Action Step 1.2 Process Question">
              <i>Process Question</i>
            </div>
          </div>
          
          <!-- Process Step 2 Row -->
          <div class="process-row" style="margin-top: 20px;">
            <div class="box sa-box" data-label="SA Process Step 2">
              <b style="text-transform: uppercase;">PROCESS STEP 2</b>
            </div>
            <div class="box sa-box" data-label="SA Action Step 2">
              ACTION STEP 2
            </div>
            <div class="box sa-box" data-label="SA Action Step 2 Why">
              <i><b>Why?</i></b>
            </div>
            <div class="box sa-box" data-label="SA Action Step 2 Process Question">
              <i>Process Question</i>
            </div>
          </div>
          
          <!-- Process Step 3 Row -->
          <div class="process-row" style="margin-top: 20px;">
            <div class="box sa-box" data-label="SA Process Step 3">
              <b style="text-transform: uppercase;">PROCESS STEP 3</b>
            </div>
            <div class="box sa-box" data-label="SA Action Step 3">
              ACTION STEP 3
            </div>
            <div class="box sa-box" data-label="SA Action Step 3 Why">
              <i><b>Why?</i></b>
            </div>
            <div class="box sa-box" data-label="SA Action Step 3 Process Question">
              <i>Process Question</i>
            </div>
          </div>
          
          <!-- Process Step 4 Row -->
          <div class="process-row" style="margin-top: 15px;">
            <div class="box sa-box" data-label="SA Process Step 4">
              <b style="text-transform: uppercase;">PROCESS STEP 4</b>
            </div>
            <div class="box sa-box" data-label="SA Action Step 4">
              ACTION STEP 4
            </div>
            <div class="box sa-box" data-label="SA Action Step 4 Why">
              <i><b>Why?</i></b>
            </div>
            <div class="box sa-box" data-label="SA Action Step 4 Process Question">
              <i>Process Question</i>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Problem Analysis Tab -->
    <div id="pa-tab" class="tab-content">
      <div class="content-layout">
        <!-- Left side: Process board -->
        <div class="process-board">
          <!-- Process Step 1 Row -->
          <div class="process-row">
            <div class="box pa-box" data-label="PA Process Step 1">
              <b style="text-transform: uppercase;">PROCESS STEP 1</b>
            </div>
            <div class="box pa-box" data-label="PA Action Step 1.1">
              ACTION STEP 1.1
            </div>
            <div class="box pa-box" data-label="PA Action Step 1.1 Sub-process Element 1">
              Sub-process Element
            </div>
            <div class="box pa-box" data-label="PA Action Step 1.1 Why">
              <i><b>Why?</i></b>
            </div>
          </div>
          
          <!-- Sub-process Elements for Action Step 1.1 -->
          <div class="process-row" style="margin-top: -5px;">
            <div class="box pa-box" data-label="PA Action Step 1.1 Sub-process Element 2" style="margin-left: 340px;">
              Sub-process Element
            </div>
            <div class="box pa-box" data-label="PA Action Step 1.1 Process Question">
              <i>Process Question</i>
            </div>
          </div>
          
          <!-- Action Step 1.2 Row -->
          <div class="process-row" style="margin-top: 15px;">
            <div class="box pa-box" data-label="PA Action Step 1.2">
              ACTION STEP 1.2
            </div>
            <div class="box pa-box" data-label="PA Action Step 1.2 Sub-process Element 1" style="margin-left: 170px;">
              Sub-process Element
            </div>
            <div class="box pa-box" data-label="PA Action Step 1.2 Sub-process Element 2">
              Sub-process Element
            </div>
          </div>
          
          <!-- Sub-process Elements for Action Step 1.2 Row 1 -->
          <div class="process-row" style="margin-top: -10px;">
            <div class="box pa-box" data-label="PA Action Step 1.2 Why">
              <i><b>Why?</i></b>
            </div>
            <div class="box pa-box" data-label="PA Action Step 1.2 Sub-process Element 3">
              Sub-process Element
            </div>
          </div>
          
          <!-- Sub-process Elements for Action Step 1.2 Row 2 -->
          <div class="process-row" style="margin-top: -10px;">
            <div class="box pa-box" data-label="PA Action Step 1.2 Sub-process Element 4" style="margin-left: 170px;">
              Sub-process Element
            </div>
            <div class="box pa-box" data-label="PA Action Step 1.2 Process Question 1">
              <i>Process Question</i>
            </div>
          </div>
          <div class="process-row" style="margin-top: -10px;">
            <div class="box pa-box" data-label="PA Action Step 1.2 Sub-process Element 5" style="margin-left: 170px;">
              Sub-process Element
            </div>
          </div>
          <div class="process-row" style="margin-top: -10px;">
            <div class="box pa-box" data-label="PA Action Step 1.2 Sub-process Element 6" style="margin-left: 170px;">
              Sub-process Element
            </div>
            <div class="box pa-box" data-label="PA Action Step 1.2 Process Question 2" style="margin-left: 170px;">
              <i>Process Question</i>
            </div>
          </div>
                   
          <!-- Process Step 2 Row -->
          <div class="process-row" style="margin-top: 15px;">
            <div class="box pa-box" data-label="PA Process Step 2">
              <b style="text-transform: uppercase;">PROCESS STEP 2</b>
            </div>
            <div class="box pa-box" data-label="PA Action Step 2.1" style="margin-top: 30px;">
              ACTION STEP 2.1
            </div>
            <div class="box pa-box" data-label="PA Action Step 2.2" style="margin-top: 30px;">
              ACTION STEP 2.2
            </div>
            <div class="box pa-box" data-label="PA Action Step 2.2 Process Question" style="margin-top: 30px;">
              <i>Process Question</i>
            </div>
          </div>
          
          <!-- Action Step 2.2 Row -->
          <div class="process-row" style="margin-top: -10px;">
            <div class="box pa-box" data-label="PA Action Step 2.1 Why"  style="margin-left: 170px;">
              <i><b>Why?</i></b>
            </div>
          </div>
          
          <!-- Process Step 3 Row -->
          <div class="process-row" style="margin-top: 15px;">
            <div class="box pa-box" data-label="PA Process Step 3">
              <b style="text-transform: uppercase;">PROCESS STEP 3</b>
            </div>
            <div class="box pa-box" data-label="PA Action Step 3.1">
              ACTION STEP 3.1
            </div>
            <div class="box pa-box" data-label="PA Action Step 3.1 Why">
              <i><b>Why?</i></b>
            </div>
            <div class="box pa-box" data-label="PA Action Step 3.1 Process Question">
              <i>Process Question</i>
            </div>
          </div>
          
          <!-- Action Step 3.2 Row -->
          <div class="process-row" style="margin-top: -10px;">
            <div class="box pa-box" data-label="PA Action Step 3.2" style="margin-left: 170px;">
              ACTION STEP 3.2
            </div>
            <div class="box pa-box" data-label="PA Action Step 3.2 Why">
              <i><b>Why?</i></b>
            </div>
          </div>
          
          <!-- Process Step 4 Row -->
          <div class="process-row" style="margin-top: 15px;">
            <div class="box pa-box" data-label="PA Process Step 4">
              <b style="text-transform: uppercase;">PROCESS STEP 4</b>
            </div>
            <div class="box pa-box" data-label="PA Action Step 4">
              ACTION STEP 4
            </div>
            <div class="box pa-box" data-label="PA Action Step 4 Why">
              <i><b>Why?</i></b>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Full Process Tab -->
    <div id="fp-tab" class="tab-content">
      <div class="content-layout">
        <!-- Left side: Process board with two columns -->
        <div class="process-board">
          <div class="fp-columns-container">
            <!-- Left Column - Situation Appraisal -->
            <div class="fp-column">
              <div class="fp-section-heading fp-sa-heading">Situation Appraisal</div>
              
              <!-- Process Step 1 Row -->
              <div class="process-row">
                <div class="box sa-box" data-label="SA Process Step 1">
                  <b style="text-transform: uppercase;">PROCESS STEP 1</b>
                </div>
                <div class="box sa-box" data-label="SA Action Step 1.1">
                  ACTION STEP 1.1
                </div>
                <div class="box sa-box" data-label="SA Action Step 1.1 Why">
                  <i><b>Why?</i></b>
                </div>
                <div class="box sa-box" data-label="SA Action Step 1.1 Process Question">
                  <i>Process Question</i>
                </div>
              </div>
              
              <!-- Action Step 1.2 Row -->
              <div class="process-row" style="margin-top: 10px;">
                <div class="box sa-box" data-label="SA Action Step 1.2" style="margin-left: 170px;">
                  ACTION STEP 1.2
                </div>
                <div class="box sa-box" data-label="SA Action Step 1.2 Why">
                  <i><b>Why?</i></b>
                </div>
                <div class="box sa-box" data-label="SA Action Step 1.2 Process Question">
                  <i>Process Question</i>
                </div>
              </div>
              
              <!-- Process Step 2 Row -->
              <div class="process-row" style="margin-top: 40px;">
                <div class="box sa-box" data-label="SA Process Step 2">
                  <b style="text-transform: uppercase;">PROCESS STEP 2</b>
                </div>
                <div class="box sa-box" data-label="SA Action Step 2">
                  ACTION STEP 2
                </div>
                <div class="box sa-box" data-label="SA Action Step 2 Why">
                  <i><b>Why?</i></b>
                </div>
                <div class="box sa-box" data-label="SA Action Step 2 Process Question">
                  <i>Process Question</i>
                </div>
              </div>
              
              <!-- Process Step 3 Row -->
              <div class="process-row" style="margin-top: 40px;">
                <div class="box sa-box" data-label="SA Process Step 3">
                  <b style="text-transform: uppercase;">PROCESS STEP 3</b>
                </div>
                <div class="box sa-box" data-label="SA Action Step 3">
                  ACTION STEP 3
                </div>
                <div class="box sa-box" data-label="SA Action Step 3 Why">
                  <i><b>Why?</i></b>
                </div>
                <div class="box sa-box" data-label="SA Action Step 3 Process Question">
                  <i>Process Question</i>
                </div>
              </div>
              
              <!-- Process Step 4 Row -->
              <div class="process-row" style="margin-top: 40px;">
                <div class="box sa-box" data-label="SA Process Step 4">
                  <b style="text-transform: uppercase;">PROCESS STEP 4</b>
                </div>
                <div class="box sa-box" data-label="SA Action Step 4">
                  ACTION STEP 4
                </div>
                <div class="box sa-box" data-label="SA Action Step 4 Why">
                  <i><b>Why?</i></b>
                </div>
                <div class="box sa-box" data-label="SA Action Step 4 Process Question">
                  <i>Process Question</i>
                </div>
              </div>
              
              <!-- Column divider -->
              <div class="fp-column-divider"></div>
            </div>
            
            <!-- Right Column - Problem Analysis -->
            <div class="fp-column">
              <div class="fp-section-heading fp-pa-heading">Problem Analysis</div>
              
              <!-- Process Step 1 Row -->
              <div class="process-row">
                <div class="box pa-box" data-label="PA Process Step 1">
                  <b style="text-transform: uppercase;">PROCESS STEP 1</b>
                </div>
                <div class="box pa-box" data-label="PA Action Step 1.1">
                  ACTION STEP 1.1
                </div>
                <div class="box pa-box" data-label="PA Action Step 1.1 Sub-process Element 1">
                  Sub-process Element
                </div>
                <div class="box pa-box" data-label="PA Action Step 1.1 Why">
                  <i><b>Why?</i></b>
                </div>
              </div>
              
              <!-- Sub-process Elements for Action Step 1.1 -->
              <div class="process-row" style="margin-top: 10px;">
                <div class="box pa-box" data-label="PA Action Step 1.1 Sub-process Element 2" style="margin-left: 340px;">
                  Sub-process Element
                </div>
                <div class="box pa-box" data-label="PA Action Step 1.1 Process Question">
                  <i>Process Question</i>
                </div>
              </div>
              
              <!-- Action Step 1.2 Row -->
              <div class="process-row" style="margin-top: 40px;">
                <div class="box pa-box" data-label="PA Action Step 1.2">
                  ACTION STEP 1.2
                </div>
                <div class="box pa-box" data-label="PA Action Step 1.2 Sub-process Element 1" style="margin-left: 170px;">
                  Sub-process Element
                </div>
                <div class="box pa-box" data-label="PA Action Step 1.2 Sub-process Element 2">
                  Sub-process Element
                </div>
              </div>
              
              <!-- Sub-process Elements for Action Step 1.2 Row 1 -->
              <div class="process-row" style="margin-top: 10px;">
                <div class="box pa-box" data-label="PA Action Step 1.2 Why">
                  <i><b>Why?</i></b>
                </div>
                <div class="box pa-box" data-label="PA Action Step 1.2 Sub-process Element 3">
                  Sub-process Element
                </div>
              </div>
              
              <!-- Sub-process Elements for Action Step 1.2 Row 2 -->
              <div class="process-row" style="margin-top: 10px;">
                <div class="box pa-box" data-label="PA Action Step 1.2 Sub-process Element 4" style="margin-left: 170px;">
                  Sub-process Element
                </div>
                <div class="box pa-box" data-label="PA Action Step 1.2 Process Question 1">
                  <i>Process Question</i>
                </div>
              </div>
              <div class="process-row" style="margin-top: 10px;">
                <div class="box pa-box" data-label="PA Action Step 1.2 Sub-process Element 5" style="margin-left: 170px;">
                  Sub-process Element
                </div>
              </div>
              <div class="process-row" style="margin-top: 10px;">
                <div class="box pa-box" data-label="PA Action Step 1.2 Sub-process Element 6" style="margin-left: 170px;">
                  Sub-process Element
                </div>
                <div class="box pa-box" data-label="PA Action Step 1.2 Process Question 2" style="margin-left: 170px;">
                  <i>Process Question</i>
                </div>
              </div>
              
              <!-- Process Step 2 Row -->
              <div class="process-row" style="margin-top: 40px;">
                <div class="box pa-box" data-label="PA Process Step 2">
                  <b style="text-transform: uppercase;">PROCESS STEP 2</b>
                </div>
                <div class="box pa-box" data-label="PA Action Step 2.1">
                  ACTION STEP 2.1
                </div>
                <div class="box pa-box" data-label="PA Action Step 2.2">
                  ACTION STEP 2.2
                </div>
                <div class="box pa-box" data-label="PA Action Step 2.2 Process Question">
                  <i>Process Question</i>
                </div>
              </div>
              
              <!-- Action Step 2.2 Row -->
              <div class="process-row" style="margin-top: 10px;">
                <div class="box pa-box" data-label="PA Action Step 2.1 Why" style="margin-left: 170px;">
                  <i><b>Why?</i></b>
                </div>
              </div>
              
              <!-- Process Step 3 Row -->
              <div class="process-row" style="margin-top: 40px;">
                <div class="box pa-box" data-label="PA Process Step 3">
                  <b style="text-transform: uppercase;">PROCESS STEP 3</b>
                </div>
                <div class="box pa-box" data-label="PA Action Step 3.1">
                  ACTION STEP 3.1
                </div>
                <div class="box pa-box" data-label="PA Action Step 3.1 Why">
                  <i><b>Why?</i></b>
                </div>
                <div class="box pa-box" data-label="PA Action Step 3.1 Process Question">
                  <i>Process Question</i>
                </div>
              </div>
              
              <!-- Action Step 3.2 Row -->
              <div class="process-row" style="margin-top: 10px;">
                <div class="box pa-box" data-label="PA Action Step 3.2" style="margin-left: 170px;">
                  ACTION STEP 3.2
                </div>
                <div class="box pa-box" data-label="PA Action Step 3.2 Why">
                  <i><b>Why?</i></b>
                </div>
              </div>
              
              <!-- Process Step 4 Row -->
              <div class="process-row" style="margin-top: 40px;">
                <div class="box pa-box" data-label="PA Process Step 4">
                  <b style="text-transform: uppercase;">PROCESS STEP 4</b>
                </div>
                <div class="box pa-box" data-label="PA Action Step 4">
                  ACTION STEP 4
                </div>
                <div class="box pa-box" data-label="PA Action Step 4 Why">
                  <i><b>Why?</i></b>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="sa-notes-container" class="notes-area-container">
    <div class="notes-header sa-notes-header">
      <h3 class="notes-title">Situation Appraisal Notes</h3>
    </div>
    <div id="sa-notes" class="notes-area">
      <div class="note sa-note" draggable="true" data-target="SA Process Step 1"><b>IDENTIFY CONCERNS</b></div>
      <div class="note sa-note" draggable="true" data-target="SA Process Step 2"><b>SET PRIORITY</b></div>
      <div class="note sa-note" draggable="true" data-target="SA Process Step 3"><b>PLAN NEXT STEPS</b></div>
      <div class="note sa-note" draggable="true" data-target="SA Process Step 4"><b>PLAN INVOLVEMENT</b></div>
      <div class="note sa-note" draggable="true" data-target="SA Action Step 1.1">LIST THREATS AND OPPORTUNITIES</div>
      <div class="note sa-note" draggable="true" data-target="SA Action Step 1.1 Why"><b><i>To make them visible</i></b></div>
      <div class="note sa-note" draggable="true" data-target="SA Action Step 1.1 Process Question"><i>What bothers us about…?</i></div>
      <div class="note sa-note" draggable="true" data-target="SA Action Step 1.2">SEPARATE AND CLARIFY</div>
      <div class="note sa-note" draggable="true" data-target="SA Action Step 1.2 Why"><b><i>To allow further analysis and resolution</i></b></div>
      <div class="note sa-note" draggable="true" data-target="SA Action Step 1.2 Process Question"><i>What do you mean by…?</i></div>
      <div class="note sa-note" draggable="true" data-target="SA Action Step 2">CONSIDER CURRENT IMPACT, FUTURE IMPACT, TIME FRAME</div>
      <div class="note sa-note" draggable="true" data-target="SA Action Step 2 Why"><b><i>To know where to use resources for the greatest gain</i></b></div>
      <div class="note sa-note" draggable="true" data-target="SA Action Step 2 Process Question"><i>What is the current impact?</i></div>
      <div class="note sa-note" draggable="true" data-target="SA Action Step 3">DETERMINE ANALYSIS NEEDED</div>
      <div class="note sa-note" draggable="true" data-target="SA Action Step 3 Why"><b><i>To ensure effective and efficient use of analysis</i></b></div>
      <div class="note sa-note" draggable="true" data-target="SA Action Step 3 Process Question"><i>Do we have a deviation? Is cause unknown? Do we need to know cause?</i></div>
      <div class="note sa-note" draggable="true" data-target="SA Action Step 4">DETERMINE HELP NEEDED</div>
      <div class="note sa-note" draggable="true" data-target="SA Action Step 4 Why"><b><i>To ensure appropriate involvement and commitment</i></b></div>
      <div class="note sa-note" draggable="true" data-target="SA Action Step 4 Process Question"><i>Who should be involved?</i></div>
    </div>
    <div class="resize-handle sa-resize-handle handle-n" data-direction="n"></div>
    <div class="resize-handle sa-resize-handle handle-e" data-direction="e"></div>
    <div class="resize-handle sa-resize-handle handle-s" data-direction="s"></div>
    <div class="resize-handle sa-resize-handle handle-w" data-direction="w"></div>
    <div class="resize-handle sa-resize-handle handle-ne" data-direction="ne"></div>
    <div class="resize-handle sa-resize-handle handle-nw" data-direction="nw"></div>
    <div class="resize-handle sa-resize-handle handle-se" data-direction="se"></div>
    <div class="resize-handle sa-resize-handle handle-sw" data-direction="sw"></div>
  </div>
  
  <div id="pa-notes-container" class="notes-area-container">
    <div class="notes-header pa-notes-header">
      <h3 class="notes-title">Problem Analysis Notes</h3>
    </div>
    <div id="pa-notes" class="notes-area">
      <!-- Process Steps -->
      <div class="note pa-note" draggable="true" data-target="PA Process Step 1"><b>DESCRIBE PROBLEM</b></div>
      <div class="note pa-note" draggable="true" data-target="PA Process Step 2"><b>IDENTIFY POSSIBLE CAUSES</b></div>
      <div class="note pa-note" draggable="true" data-target="PA Process Step 3"><b>EVALUATE POSSIBLE CAUSES</b></div>
      <div class="note pa-note" draggable="true" data-target="PA Process Step 4"><b>CONFIRM TRUE CAUSE</b></div>
      
      <!-- Action Steps 1.1 and related -->
      <div class="note pa-note" draggable="true" data-target="PA Action Step 1.1">STATE THE PROBLEM</div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 1.1 Why"><b><i>To help stay on track</i></b></div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 1.1 Process Question"><i>What do we see that tells us there is a deviation?</i></div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 1.1 Sub-process Element 1">OBJECT</div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 1.1 Sub-process Element 2">DEVIATION</div>
      
      <!-- Action Steps 1.2 and related -->
      <div class="note pa-note" draggable="true" data-target="PA Action Step 1.2">SPECIFY THE PROBLEM</div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 1.2 Why"><b><i>To increase understanding of the deviation</i></b></div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 1.2 Sub-process Element 1">IS</div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 1.2 Sub-process Element 2">IS NOT</div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 1.2 Sub-process Element 3">WHAT?</div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 1.2 Sub-process Element 4">WHERE?</div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 1.2 Sub-process Element 5">WHEN?</div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 1.2 Sub-process Element 6">EXTENT?</div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 1.2 Process Question 1"><i>Where is the deviation on the object?</i></div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 1.2 Process Question 2"><i>How many objects could have the deviation, but do not?</i></div>
      
      <!-- Action Steps 2.1 and related -->
      <div class="note pa-note" draggable="true" data-target="PA Action Step 2.1">KNOWLEDGE AND EXPERIENCE</div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 2.1 Why"><b><i>To create statements you can test against the facts</i></b></div>
      
      <!-- Action Steps 2.2 and related -->
      <div class="note pa-note" draggable="true" data-target="PA Action Step 2.2">DISTINCTIONS AND CHANGES</div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 2.2 Process Question"><i>What has changed in, on, around, or about…?</i></div>
      
      <!-- Action Steps 3.1 and related -->
      <div class="note pa-note" draggable="true" data-target="PA Action Step 3.1">TEST POSSIBLE CAUSES</div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 3.1 Why"><b><i>To get rid of causes that do not make sense</i></b></div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 3.1 Process Question"><i>If ___ is the cause of _____, how does that explain both the IS and the IS NOT?</i></div>
      
      <!-- Action Steps 3.2 and related -->
      <div class="note pa-note" draggable="true" data-target="PA Action Step 3.2">DETERMINE MOST PROBABLE CAUSE</div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 3.2 Why"><b><i>To pick the possible cause to verify first</i></b></div>
      
      <!-- Action Step 4 and related -->
      <div class="note pa-note" draggable="true" data-target="PA Action Step 4">VERIFY ASSUMPTIONS, OBSERVE, EXPERIMENT, OR TRY A FIX AND MONITOR</div>
      <div class="note pa-note" draggable="true" data-target="PA Action Step 4 Why"><b><i>To avoid wasting resources</i></b></div>
    </div>
    <div class="resize-handle pa-resize-handle handle-n" data-direction="n"></div>
    <div class="resize-handle pa-resize-handle handle-e" data-direction="e"></div>
    <div class="resize-handle pa-resize-handle handle-s" data-direction="s"></div>
    <div class="resize-handle pa-resize-handle handle-w" data-direction="w"></div>
    <div class="resize-handle pa-resize-handle handle-ne" data-direction="ne"></div>
    <div class="resize-handle pa-resize-handle handle-nw" data-direction="nw"></div>
    <div class="resize-handle pa-resize-handle handle-se" data-direction="se"></div>
    <div class="resize-handle pa-resize-handle handle-sw" data-direction="sw"></div>
  </div>
  
  <!-- Full Process Notes Container -->
  <div id="fp-notes-container" class="notes-area-container">
    <div class="notes-header fp-notes-header">
      <h3 class="notes-title">Full Process Notes</h3>
    </div>
    <div id="fp-notes" class="notes-area">
      <!-- SA Process Notes -->
      <div class="note fp-note" draggable="true" data-target="SA Process Step 1"><b>IDENTIFY CONCERNS</b></div>
      <div class="note fp-note" draggable="true" data-target="SA Process Step 2"><b>SET PRIORITY</b></div>
      <div class="note fp-note" draggable="true" data-target="SA Process Step 3"><b>PLAN NEXT STEPS</b></div>
      <div class="note fp-note" draggable="true" data-target="SA Process Step 4"><b>PLAN INVOLVEMENT</b></div>
      <div class="note fp-note" draggable="true" data-target="SA Action Step 1.1">LIST THREATS AND OPPORTUNITIES</div>
      <div class="note fp-note" draggable="true" data-target="SA Action Step 1.1 Why"><b><i>To make them visible</i></b></div>
      <div class="note fp-note" draggable="true" data-target="SA Action Step 1.1 Process Question"><i>What bothers us about…?</i></div>
      <div class="note fp-note" draggable="true" data-target="SA Action Step 1.2">SEPARATE AND CLARIFY</div>
      <div class="note fp-note" draggable="true" data-target="SA Action Step 1.2 Why"><b><i>To allow further analysis and resolution</i></b></div>
      <div class="note fp-note" draggable="true" data-target="SA Action Step 1.2 Process Question"><i>What do you mean by…?</i></div>
      <div class="note fp-note" draggable="true" data-target="SA Action Step 2">CONSIDER CURRENT IMPACT, FUTURE IMPACT, TIME FRAME</div>
      <div class="note fp-note" draggable="true" data-target="SA Action Step 2 Why"><b><i>To know where to use resources for the greatest gain</i></b></div>
      <div class="note fp-note" draggable="true" data-target="SA Action Step 2 Process Question"><i>What is the current impact?</i></div>
      <div class="note fp-note" draggable="true" data-target="SA Action Step 3">DETERMINE ANALYSIS NEEDED</div>
      <div class="note fp-note" draggable="true" data-target="SA Action Step 3 Why"><b><i>To ensure effective and efficient use of analysis</i></b></div>
      <div class="note fp-note" draggable="true" data-target="SA Action Step 3 Process Question"><i>Do we have a deviation? Is cause unknown? Do we need to know cause?</i></div>
      <div class="note fp-note" draggable="true" data-target="SA Action Step 4">DETERMINE HELP NEEDED</div>
      <div class="note fp-note" draggable="true" data-target="SA Action Step 4 Why"><b><i>To ensure appropriate involvement and commitment</i></b></div>
      <div class="note fp-note" draggable="true" data-target="SA Action Step 4 Process Question"><i>Who should be involved?</i></div>
      
      <!-- PA Process Notes -->
      <div class="note fp-note" draggable="true" data-target="PA Process Step 1"><b>DESCRIBE PROBLEM</b></div>
      <div class="note fp-note" draggable="true" data-target="PA Process Step 2"><b>IDENTIFY POSSIBLE CAUSES</b></div>
      <div class="note fp-note" draggable="true" data-target="PA Process Step 3"><b>EVALUATE POSSIBLE CAUSES</b></div>
      <div class="note fp-note" draggable="true" data-target="PA Process Step 4"><b>CONFIRM TRUE CAUSE</b></div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 1.1">STATE THE PROBLEM</div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 1.1 Why"><b><i>To help stay on track</i></b></div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 1.1 Process Question"><i>What do we see that tells us there is a deviation?</i></div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 1.1 Sub-process Element 1">OBJECT</div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 1.1 Sub-process Element 2">DEVIATION</div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 1.2">SPECIFY THE PROBLEM</div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 1.2 Why"><b><i>To increase understanding of the deviation</i></b></div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 1.2 Sub-process Element 1">IS</div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 1.2 Sub-process Element 2">IS NOT</div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 1.2 Sub-process Element 3">WHAT?</div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 1.2 Sub-process Element 4">WHERE?</div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 1.2 Sub-process Element 5">WHEN?</div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 1.2 Sub-process Element 6">EXTENT?</div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 1.2 Process Question 1"><i>Where is the deviation on the object?</i></div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 1.2 Process Question 2"><i>How many objects could have the deviation, but do not?</i></div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 2.1">KNOWLEDGE AND EXPERIENCE</div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 2.1 Why"><b><i>To create statements you can test against the facts</i></b></div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 2.2">DISTINCTIONS AND CHANGES</div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 2.2 Process Question"><i>What has changed in, on, around, or about…?</i></div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 3.1">TEST POSSIBLE CAUSES</div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 3.1 Why"><b><i>To get rid of causes that do not make sense</i></b></div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 3.1 Process Question"><i>If ___ is the cause of _____, how does that explain both the IS and the IS NOT?</i></div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 3.2">DETERMINE MOST PROBABLE CAUSE</div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 3.2 Why"><b><i>To pick the possible cause to verify first</i></b></div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 4">VERIFY ASSUMPTIONS, OBSERVE, EXPERIMENT, OR TRY A FIX AND MONITOR</div>
      <div class="note fp-note" draggable="true" data-target="PA Action Step 4 Why"><b><i>To avoid wasting resources</i><b/></div>
    </div>
    <div class="resize-handle fp-resize-handle handle-n" data-direction="n"></div>
    <div class="resize-handle fp-resize-handle handle-e" data-direction="e"></div>
    <div class="resize-handle fp-resize-handle handle-s" data-direction="s"></div>
    <div class="resize-handle fp-resize-handle handle-w" data-direction="w"></div>
    <div class="resize-handle fp-resize-handle handle-ne" data-direction="ne"></div>
    <div class="resize-handle fp-resize-handle handle-nw" data-direction="nw"></div>
    <div class="resize-handle fp-resize-handle handle-se" data-direction="se"></div>
    <div class="resize-handle fp-resize-handle handle-sw" data-direction="sw"></div>
  </div>

  <!-- Help Popup and Overlay -->
  <div id="help-overlay" class="overlay"></div>
  <div id="help-popup" class="help-popup">
    <div class="help-popup-header">
      <h2 id="help-popup-title">Instructions</h2>
      <button id="help-popup-close" class="help-popup-close">&times;</button>
    </div>
    <div id="help-popup-content" class="help-popup-content">
      <!-- SA Instructions -->
      <div id="sa-instructions">
        <h3>Situation Appraisal Instructions</h3>
        <p>Welcome to the Kepner-Tregoe Situation Appraisal exercise. Drag each blue note from the right panel to its matching box on the left.</p>
        <ul>
          <li>Select <strong>Submit Answers</strong> to check your work.</li>
          <li>Use <strong>Reset Exercise</strong> to start over.</li>
          <li><strong>Show Hints</strong> highlights the correct box for any wrong notes (disabled in Hard Mode).</li>
        </ul>
        <p><strong>Hard Mode</strong> hides hints, requires all notes to be placed before submitting, and returns only the incorrect ones.</p>
        <p class="tip">Tip: Match the note font to the box font for easier reading.</p>
        <p><strong>What's new in Version 5?</strong></p>
        <ul>
          <li>The notes panel can be positioned anywhere on screen.</li>
          <li>Drag the title bar to move it.</li>
          <li>Drag the corner handle to resize the panel.</li>
          <li>Notes reorganize automatically as you resize.</li>
          <li>The panel opens wide enough for two columns of notes.</li>
        </ul>
      </div>
      
      <!-- PA Instructions -->
      <div id="pa-instructions" style="display: none;">
        <h3>Problem Analysis Instructions</h3>
        <p>Welcome to the Kepner-Tregoe Problem Analysis exercise. Drag each red note from the right panel to its matching box on the left.</p>
        <ul>
          <li>Select <strong>Submit Answers</strong> to check your work.</li>
          <li>Use <strong>Reset Exercise</strong> to start over.</li>
          <li><strong>Show Hints</strong> highlights the correct box for any wrong notes (disabled in Hard Mode).</li>
        </ul>
        <p><strong>Hard Mode</strong> hides hints, requires all notes to be placed before submitting, and returns only the incorrect ones.</p>
        <p class="tip">Tip: Match the note font to the box font for easier reading.</p>
        <p><strong>What's new in Version 5?</strong></p>
        <ul>
          <li>The notes panel can be positioned anywhere on screen.</li>
          <li>Drag the title bar to move it.</li>
          <li>Drag the corner handle to resize the panel.</li>
          <li>Notes reorganize automatically as you resize.</li>
          <li>The panel opens wide enough for two columns of notes.</li>
        </ul>
      </div>
      
      <!-- FP Instructions -->
      <div id="fp-instructions" style="display: none;">
        <h3>Full Process Instructions</h3>
        <p>Welcome to the Kepner-Tregoe Full Process exercise. Drag each note from the right panel to its matching box on the left.</p>
        <ul>
          <li>Select <strong>Submit Answers</strong> to check your work.</li>
          <li>Use <strong>Reset Exercise</strong> to start over.</li>
          <li><strong>Show Hints</strong> highlights the correct box for any wrong notes (disabled in Hard Mode).</li>
        </ul>
        <p><strong>Hard Mode</strong> hides hints, requires all notes to be placed before submitting, and returns only the incorrect ones.</p>
        <p class="tip">Tip: Match the note font to the box font for easier reading.</p>
      </div>
    </div>
  </div>

  <script>
    // Configuration object for the application
    const config = {
      tabs: {
        sa: {
          color: '#0057B7',
          totalNotes: 19
        },
        pa: {
          color: '#E03C31',
          totalNotes: 30
        },
        fp: {
          color: '#b2b2b2',
          totalNotes: 49
        }
      }
    };
    
    // Consolidated hints object
    const hints = {
      sa: {
        "Process Step 1": "The first step in Situation Appraisal focuses on making concerns visible so they can be addressed.",
        "Process Step 2": "This step focuses on determining the priority of concerns based on impact and time constraints.",
        "Process Step 3": "This step involves determining what kind of analysis is required to address the concern.",
        "Process Step 4": "This final step addresses who needs to be involved in resolving the concern.",
        "Action Step 1.1": "This action involves identifying both positive (opportunities) and negative (threats) concerns.",
        "Action Step 1.1 Why": "The purpose of this action is to make concerns visible so they can be addressed.",
        "Action Step 1.1 Process Question": "The process question here helps identify what concerns exist.",
        "Action Step 1.2": "After identifying concerns, this action involves breaking complex issues into simpler parts.",
        "Action Step 1.2 Why": "This action helps ensure each concern is clearly understood before proceeding.",
        "Action Step 1.2 Process Question": "This question helps clarify the exact nature of each concern.",
        "Action Step 2": "This action involves determining urgency by looking at multiple factors.",
        "Action Step 2 Why": "This helps focus resources on the most important concerns first.",
        "Action Step 2 Process Question": "This question helps assess the current impact of a concern.",
        "Action Step 3": "This action involves selecting the appropriate analysis process for each concern.",
        "Action Step 3 Why": "This ensures the right analysis method is used for each type of concern.",
        "Action Step 3 Process Question": "These questions help determine which KT process to use.",
        "Action Step 4": "This action focuses on who should be involved in addressing the concern.",
        "Action Step 4 Why": "This ensures proper buy-in and expertise for resolving the concern.",
        "Action Step 4 Process Question": "This question identifies stakeholders needed to address the concern."
      },
      pa: {
        "Process Step 1": "The first step in Problem Analysis focuses on clearly defining the problem before attempting to solve it.",
        "Process Step 2": "After describing the problem, this step involves generating possible causes to investigate.",
        "Process Step 3": "This step involves evaluating the possible causes against the facts to identify the most likely one.",
        "Process Step 4": "The final step is about validating the cause before implementing a solution.",
        "Action Step 1.1": "This action involves defining the problem with a clear statement of what's wrong.",
        "Action Step 1.1 Why": "A clear problem statement keeps the analysis focused on the actual issue.",
        "Action Step 1.1 Process Question": "This question helps identify the specific deviation that defines the problem.",
        "Action Step 1.1 Sub-process Element 1": "This element identifies what specific item or entity has the problem.",
        "Action Step 1.1 Sub-process Element 2": "This element specifies what exactly is wrong with the object.",
        "Action Step 1.2": "This action involves gathering detailed information about the problem's characteristics.",
        "Action Step 1.2 Why": "Specifying details helps understand patterns that point to the cause.",
        "Action Step 1.2 Sub-process Element 1": "This element describes what we observe where the problem exists.",
        "Action Step 1.2 Sub-process Element 2": "This element describes what we observe where we would expect the problem but it doesn't exist.",
        "Action Step 1.2 Sub-process Element 3": "This dimension focuses on the identity or nature of the problem.",
        "Action Step 1.2 Sub-process Element 4": "This dimension focuses on the physical location aspects of the problem.",
        "Action Step 1.2 Sub-process Element 5": "This dimension focuses on when the problem occurs or doesn't occur.",
        "Action Step 1.2 Sub-process Element 6": "This dimension focuses on the magnitude or quantity aspects of the problem.",
        "Action Step 1.2 Process Question 1": "This question helps determine where exactly the problem is occurring.",
        "Action Step 1.2 Process Question 2": "This question helps determine how widespread the problem is.",
        "Action Step 2.1": "This action involves using what we already know to identify potential causes.",
        "Action Step 2.1 Why": "Creating testable cause statements helps systematically evaluate possibilities.",
        "Action Step 2.2": "This action involves looking for differences and changes to identify potential causes.",
        "Action Step 2.2 Process Question": "This question helps identify changes that might have triggered the problem.",
        "Action Step 3.1": "This action involves systematically testing each possible cause against the facts.",
        "Action Step 3.1 Why": "Testing against facts eliminates improbable causes and focuses on likely ones.",
        "Action Step 3.1 Process Question": "This question tests if a proposed cause explains all aspects of the problem.",
        "Action Step 3.2": "This action involves selecting the most likely cause from those that survived testing.",
        "Action Step 3.2 Why": "Determining the most probable cause helps focus verification efforts efficiently.",
        "Action Step 4": "This action involves confirming the true cause through verification methods.",
        "Action Step 4 Why": "Confirming the cause prevents wasting resources on solving the wrong problem."
      },
      fp: {
        "Process Step 1": "This represents the combined KT processes for comprehensive problem solving."
      }
    };

    // Flag to track Hard Mode state
    let hardModeEnabled = false;
    // Flag to track Demon Mode state
    let demonModeEnabled = false;
    
    // Initialize the app
    document.addEventListener('DOMContentLoaded', function() {
      initializeTabs();
      initializeDragAndDrop();
      initializeHelpPopup();
      initializeHardMode();
      initializeDemonMode();
      initializeDraggableNotesPanel();
      initializeResizableNotesPanel();
      document.querySelector('.container').classList.add('normal-mode');
      shuffleAllNotes();
    });
    



function initializeHardMode() {
  const hardModeBtn = document.getElementById('hard-mode-btn');
  
  hardModeBtn.addEventListener('click', function() {
    // Toggle the mode
    hardModeEnabled = !hardModeEnabled;
    
    // Toggle active class on button
    if (hardModeEnabled) {
      this.classList.add('active');
      this.textContent = 'Hard Mode: ON';
    } else {
      this.classList.remove('active');
      this.textContent = 'Hard Mode';
    }
    
    // Toggle class on the container for styling
    const container = document.querySelector('.container');
    if (hardModeEnabled) {
      container.classList.add('hard-mode');
      container.classList.remove('normal-mode');
      
      // Directly apply styles to all FP notes
      const fpNotes = document.querySelectorAll('.fp-note');
      fpNotes.forEach(note => {
        // Force the gray style
        note.style.borderColor = '#b2b2b2';
        note.style.backgroundColor = '#f2f2f2';
      });
    } else {
      container.classList.add('normal-mode');
      container.classList.remove('hard-mode');
      
      // Restore original colors based on note type
      const fpNotes = document.querySelectorAll('.fp-note');
      fpNotes.forEach(note => {
        const target = note.getAttribute('data-target');
        if (target.startsWith('SA')) {
          note.style.borderColor = '#0057B7';
          note.style.backgroundColor = '#F1F7FD';
        } else if (target.startsWith('PA')) {
          note.style.borderColor = '#E03C31';
          note.style.backgroundColor = '#FEF0EF';
        }
      });
    }
    
    // Get active tab
    const activeTab = document.querySelector('.tab.active').getAttribute('data-tab');
    
    // Hide score and hints display for any tab when toggling hard mode
    document.getElementById(`${activeTab}-score`).style.display = 'none';
    document.getElementById(`show-hints-${activeTab}-btn`).style.display = 'none';
    
    // Special handling for Full Process tab to prevent duplications
    if (activeTab === 'fp') {
      // ONLY get notes from the FP notes area and from FP tab boxes
      const notesInArea = Array.from(document.getElementById('fp-notes').querySelectorAll('.note'));
      const notesInBoxes = Array.from(document.querySelectorAll('#fp-tab .box .note'));
      const allNotes = [...notesInArea, ...notesInBoxes];
      
      // Clear only the FP notes area
      const notesArea = document.getElementById('fp-notes');
      while (notesArea.firstChild) {
        notesArea.removeChild(notesArea.firstChild);
      }
      
      // Move all notes back to FP notes area
      allNotes.forEach(note => {
        // Handle styling
        if (hardModeEnabled) {
          note.style.borderColor = '#b2b2b2';
          note.style.backgroundColor = '#f2f2f2';
        } else {
          const target = note.getAttribute('data-target');
          if (target.startsWith('SA')) {
            note.style.borderColor = '#0057B7';
            note.style.backgroundColor = '#F1F7FD';
          } else if (target.startsWith('PA')) {
            note.style.borderColor = '#E03C31';
            note.style.backgroundColor = '#FEF0EF';
          }
        }
        
        // Remove any status classes
        note.classList.remove('correct', 'incorrect', 'show-hint');
        
        // Ensure consistent sizing
        note.style.width = '';
        note.style.height = '';
        note.style.margin = '';
        note.style.padding = '';
        note.style.fontSize = '';
        
        // Add to FP notes area
        notesArea.appendChild(note);
      });
      
      // Now shuffle the notes
      shuffleNotes('fp');
    } else {
      // For SA and PA tabs, just use the regular reset
      resetExercise(activeTab);
    }
  });
}

function initializeDemonMode() {
  const demonModeBtn = document.getElementById('demon-mode-btn');

  demonModeBtn.addEventListener('click', function() {
    demonModeEnabled = !demonModeEnabled;

    if (demonModeEnabled) {
      this.classList.add('active');
      this.textContent = 'Demon Mode: ON';
      enableDemonMode();
      // Automatically enable Hard Mode when Demon Mode is activated
      if (!hardModeEnabled) {
        document.getElementById('hard-mode-btn').click();
      }
    } else {
      this.classList.remove('active');
      this.textContent = 'Demon Mode';
      disableDemonMode();
    }
  });
}

function enableDemonMode() {
  document.querySelector('.container').classList.add('demon-mode');
  const notes = document.querySelectorAll('.note');
  notes.forEach(note => {
    if (!note.dataset.originalHtml) {
      note.dataset.originalHtml = note.innerHTML;
    }
    note.textContent = toTitleCase(note.textContent.trim());
  });
}

function disableDemonMode() {
  document.querySelector('.container').classList.remove('demon-mode');
  const notes = document.querySelectorAll('.note');
  notes.forEach(note => {
    if (note.dataset.originalHtml) {
      note.innerHTML = note.dataset.originalHtml;
    }
  });
}

function toTitleCase(str) {
  return str.toLowerCase().replace(/\b\w/g, c => c.toUpperCase());
}

    // Initialize Draggable Notes Panel
    function initializeDraggableNotesPanel() {
      const panels = [
        document.getElementById('sa-notes-container'),
        document.getElementById('pa-notes-container'),
        document.getElementById('fp-notes-container')
      ];
      
      panels.forEach(panel => {
        const header = panel.querySelector('.notes-header');
        makeElementDraggable(panel, header);
      });
    }
    
    // Initialize Resizable Notes Panel
    function initializeResizableNotesPanel() {
      const panels = [
        document.getElementById('sa-notes-container'),
        document.getElementById('pa-notes-container'),
        document.getElementById('fp-notes-container')
      ];
      const resizeOverlay = document.getElementById('resize-overlay');

      panels.forEach(panel => makeElementResizable(panel, resizeOverlay));
    }

    // Make an element resizable using multiple handles
    function makeElementResizable(element, overlay) {
      const handles = element.querySelectorAll('.resize-handle');
      let startX, startY, startWidth, startHeight, startLeft, startTop, isResizing = false, direction;

      handles.forEach(handle => {
        handle.addEventListener('mousedown', function(e) {
          if (element.classList.contains('collapsed')) return;

          isResizing = true;
          direction = handle.getAttribute('data-direction');
          startX = e.clientX;
          startY = e.clientY;
          startWidth = element.offsetWidth;
          startHeight = element.offsetHeight;
          const computed = window.getComputedStyle(element);
          startLeft = parseInt(computed.left, 10) || 0;
          startTop = parseInt(computed.top, 10) || 0;

          overlay.style.display = 'block';
          overlay.addEventListener('mousemove', resizeElement);
          overlay.addEventListener('mouseup', stopResizing);

          e.preventDefault();
        });
      });

      function resizeElement(e) {
        if (!isResizing) return;

        const dx = e.clientX - startX;
        const dy = e.clientY - startY;

        let newWidth = startWidth;
        let newHeight = startHeight;
        let newLeft = startLeft;
        let newTop = startTop;

        if (direction.includes('e')) {
          newWidth = Math.max(325, startWidth + dx);
        }
        if (direction.includes('s')) {
          newHeight = Math.max(200, startHeight + dy);
        }
        if (direction.includes('w')) {
          newWidth = Math.max(325, startWidth - dx);
          newLeft = startLeft + dx;
        }
        if (direction.includes('n')) {
          newHeight = Math.max(200, startHeight - dy);
          newTop = startTop + dy;
        }

        element.style.width = newWidth + 'px';
        element.style.height = newHeight + 'px';
        element.style.left = newLeft + 'px';
        element.style.top = newTop + 'px';
      }

      function stopResizing() {
        isResizing = false;
        overlay.style.display = 'none';
        overlay.removeEventListener('mousemove', resizeElement);
        overlay.removeEventListener('mouseup', stopResizing);
      }
    }
    
    // Make an element draggable - UPDATED for fixed positioning
    function makeElementDraggable(element, handle) {
      let startX, startY, startLeft, startTop, isDragging = false;
      
      handle.addEventListener('mousedown', function(e) {
        // Ignore if it's the collapse button
        if (e.target.classList.contains('notes-collapse-btn')) return;
        
        isDragging = true;
        
        // Get current position
        startX = e.clientX;
        startY = e.clientY;
        
        // Get the current computed position
        const computedStyle = window.getComputedStyle(element);
        startLeft = parseInt(computedStyle.left, 10) || 0;
        startTop = parseInt(computedStyle.top, 10) || 0;
        
        // Set position to fixed if not already
        element.style.position = 'fixed';
        
        // Add move and mouseup handlers to document
        document.addEventListener('mousemove', moveElement);
        document.addEventListener('mouseup', stopDragging);
        
        // Prevent text selection during drag
        e.preventDefault();
      });
      
      function moveElement(e) {
        if (!isDragging) return;
        
        // Calculate new position
        const newLeft = startLeft + (e.clientX - startX);
        const newTop = startTop + (e.clientY - startY);
        
        // Apply bounds to keep panel on screen
        const maxLeft = window.innerWidth - element.offsetWidth;
        const maxTop = window.innerHeight - element.offsetHeight;
        
        const boundedLeft = Math.max(0, Math.min(newLeft, maxLeft));
        const boundedTop = Math.max(0, Math.min(newTop, maxTop));
        
        // Update element position
        element.style.left = boundedLeft + 'px';
        element.style.top = boundedTop + 'px';
      }
      
      function stopDragging() {
        isDragging = false;
        document.removeEventListener('mousemove', moveElement);
        document.removeEventListener('mouseup', stopDragging);
      }
    }
    
    // Update UI when toggling between normal and hard mode without resetting
function updateUIForModeChange(tabId) {
  if (!hardModeEnabled) {
    // When switching from Hard Mode to Normal Mode
    // Show correct/incorrect visual indicators for notes
    updateNoteVisualFeedback(tabId);
    
    // For FP tab, restore SA/PA styling
    if (tabId === 'fp') {
      const notes = document.querySelectorAll('.fp-note');
      notes.forEach(note => {
        const target = note.getAttribute('data-target');
        if (target.startsWith('SA')) {
          note.style.borderColor = '#0057B7'; // Blue
          note.style.backgroundColor = '#F1F7FD'; // Light blue
        } else if (target.startsWith('PA')) {
          note.style.borderColor = '#E03C31'; // Red
          note.style.backgroundColor = '#FEF0EF'; // Light red
        }
      });
    }
  } else {
    // When switching to Hard Mode, remove visual indicators and reset to default styling
    const notes = document.querySelectorAll(`.note[data-target^="${tabId.toUpperCase()}"]`);
    notes.forEach(note => {
      note.classList.remove('correct', 'incorrect');
      
      // Reset FP notes to neutral color
      if (tabId === 'fp') {
        note.style.borderColor = '#b2b2b2';
        note.style.backgroundColor = '#f2f2f2';
      }
    });
  }
}
    
    // Update note visual feedback (correct/incorrect)
    function updateNoteVisualFeedback(tabId) {
      const boxesSelector = `.box[data-label^="${tabId.toUpperCase()}"]`;
      const boxes = document.querySelectorAll(boxesSelector);
      
      boxes.forEach(box => {
        const note = box.querySelector('.note');
        if (note) {
          const isCorrect = box.getAttribute('data-label') === note.getAttribute('data-target');
          if (isCorrect) {
            note.classList.add('correct');
            note.classList.remove('incorrect');
          } else {
            note.classList.add('incorrect');
            note.classList.remove('correct');
          }
        }
      });
    }
    
    // Initialize tabs
    function initializeTabs() {
      const tabButtons = document.querySelectorAll('.tab');
      
      tabButtons.forEach(tab => {
        tab.addEventListener('click', function() {
          const tabId = this.getAttribute('data-tab');
          switchTab(tabId);
        });
      });
    }
    
    // Switch between tabs
    function switchTab(tabId) {
      // Update active tab
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`#${tabId}-tab-btn`).classList.add('active');
      
      // Show active content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.toggle('active', content.id === `${tabId}-tab`);
        content.style.display = content.id === `${tabId}-tab` ? 'flex' : 'none';
      });
      
      // Show/hide appropriate notes panel
      document.getElementById('sa-notes-container').style.display = tabId === 'sa' ? 'block' : 'none';
      document.getElementById('pa-notes-container').style.display = tabId === 'pa' ? 'block' : 'none';
      document.getElementById('fp-notes-container').style.display = tabId === 'fp' ? 'block' : 'none';
      
      // Show/hide appropriate buttons
      const isVisible = (id, show) => document.getElementById(id).style.display = show ? 'block' : 'none';
      isVisible('submit-sa-btn', tabId === 'sa');
      isVisible('reset-sa-btn', tabId === 'sa');
      isVisible('submit-pa-btn', tabId === 'pa');
      isVisible('reset-pa-btn', tabId === 'pa');
      isVisible('submit-fp-btn', tabId === 'fp');
      isVisible('reset-fp-btn', tabId === 'fp');
      isVisible('show-hints-sa-btn', false);
      isVisible('show-hints-pa-btn', false);
      isVisible('show-hints-fp-btn', false);
      
      // Hide score displays
      document.querySelectorAll('.score-display').forEach(el => {
        el.style.display = 'none';
        if (el.querySelector('span:last-child')) {
          el.querySelector('span:last-child').textContent = '';
        }
      });
      
      // Update help popup title color based on tab
      if (document.getElementById('help-popup-title')) {
        document.getElementById('help-popup-title').style.color = config.tabs[tabId].color;
      }
    }
    
    // Initialize drag and drop
    function initializeDragAndDrop() {
      const notes = document.querySelectorAll('.note');
      const boxes = document.querySelectorAll('.box');
      const notesAreas = {
        SA: document.getElementById('sa-notes'),
        PA: document.getElementById('pa-notes'),
        FP: document.getElementById('fp-notes')
      };
      
      // Attach drag events to notes
      attachDragEventsToNotes(notes);
      
      // Attach drop events to boxes
      attachDropEventsToBoxes(boxes, notesAreas);
      
      // Attach drop events to notes areas
      Object.values(notesAreas).forEach(area => {
        attachDropEventsToNotesArea(area);
      });
    }
    
    // Attach drag events to notes
    function attachDragEventsToNotes(notes) {
      notes.forEach(note => {
        note.addEventListener('dragstart', function(e) {
          this.classList.add('dragging');
          e.dataTransfer.setData('text/plain', this.getAttribute('data-target'));
        });
        
        note.addEventListener('dragend', function() {
          this.classList.remove('dragging');
          document.querySelectorAll('.box.highlight').forEach(box => {
            box.classList.remove('highlight');
          });
        });
      });
    }
    
    // Attach drop events to boxes
    function attachDropEventsToBoxes(boxes, notesAreas) {
      boxes.forEach(box => {
        box.addEventListener('dragover', function(e) {
          e.preventDefault();
          this.classList.add('highlight');
        });
        
        box.addEventListener('dragleave', function() {
          this.classList.remove('highlight');
        });
        
        box.addEventListener('drop', function(e) {
          e.preventDefault();
          this.classList.remove('highlight');
          
          const dataTarget = e.dataTransfer.getData('text/plain');
          const draggingNote = document.querySelector('.dragging');
          
        const isFullProcessTab = document.getElementById('fp-tab').classList.contains('active');
  
        // In FP tab, allow any note in any box. In other tabs, only allow matching prefixes.
        if (draggingNote && (isFullProcessTab || 
            dataTarget.substring(0, 2) === box.getAttribute('data-label').substring(0, 2))) {
          // If a note already exists in this box, move it back to the notes area
          if (this.querySelector('.note')) {
            const existingNote = this.querySelector('.note');
            if (isFullProcessTab) {
              // Always return displaced notes to the FP notes area in Full Process mode
              notesAreas['FP'].appendChild(existingNote);
            } else {
              const prefix = existingNote.getAttribute('data-target').substring(0, 2);
              const notesArea = notesAreas[prefix];
              notesArea.appendChild(existingNote);
            }
          }
    
          this.appendChild(draggingNote);
        }
        });
      });
    }
    
    // Attach drop events to notes area
    function attachDropEventsToNotesArea(area) {
      area.addEventListener('dragover', function(e) {
        e.preventDefault();
      });

      area.addEventListener('drop', function(e) {
        e.preventDefault();
        const draggingNote = document.querySelector('.dragging');
        if (draggingNote) {
          const prefix = draggingNote.getAttribute('data-target').substring(0, 2);
          const correctArea = document.getElementById(prefix.toLowerCase() + '-notes');
          const isFullProcessArea = this.id === 'fp-notes';

          if (this === correctArea || isFullProcessArea) {
            draggingNote.classList.remove('correct', 'incorrect');
            this.appendChild(draggingNote);
          }
        }
      });
    }
    
    // Shuffle all notes
    function shuffleAllNotes() {
      shuffleNotes('sa');
      shuffleNotes('pa');
      shuffleNotes('fp');
    }
    
    // Shuffle notes
    function shuffleNotes(tabId) {
      const container = document.getElementById(`${tabId}-notes`);
      if (!container) return;
      
      const notesArray = Array.from(container.querySelectorAll('.note'));
      
      // Create a shuffled order
      for (let i = notesArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [notesArray[i], notesArray[j]] = [notesArray[j], notesArray[i]];
      }
      
      // Clear the container
      while (container.firstChild) {
        container.removeChild(container.firstChild);
      }
      
      // Append notes in shuffled order
      notesArray.forEach(note => {
        container.appendChild(note);
      });
    }
    


    // Get elements for a tab
function getTabElements(tabId) {
  return {
    notes: document.querySelectorAll(`#${tabId}-tab .box .note, #${tabId}-notes .note`),
    boxes: document.querySelectorAll(`#${tabId}-tab .box`),
    notesArea: document.getElementById(`${tabId}-notes`),
    scoreDisplay: document.getElementById(`${tabId}-score`),
    scoreValue: document.getElementById(`${tabId}-score-value`),
    message: document.getElementById(`${tabId}-message`),
    hintButton: document.getElementById(`show-hints-${tabId}-btn`)
  };
}


    // Submit answers
    function submitAnswers(tabId) {
      const elements = getTabElements(tabId);
      
      if (!elements.notes.length || !elements.scoreDisplay || !elements.scoreValue || !elements.message || !elements.notesArea) return;
      
      // For Hard Mode: Check if all notes are placed
      if (hardModeEnabled) {
        const notesInArea = Array.from(elements.notesArea.querySelectorAll('.note'));
        if (notesInArea.length > 0) {
          elements.message.textContent = "In Hard Mode, all notes must be placed before submitting.";
          elements.message.className = "empty";
          elements.scoreDisplay.style.display = 'block';
          return;
        }
      }
      
      let correct = 0;
      let totalPlaced = 0;
      const totalNotes = config.tabs[tabId].totalNotes;
      
      // Process notes in regular mode
      if (!hardModeEnabled) {
        elements.notes.forEach(note => {
          const parent = note.parentElement;
          if (parent && parent.classList.contains('box')) {
            totalPlaced++;
            const isCorrect = parent.getAttribute('data-label') === note.getAttribute('data-target');
            
            if (isCorrect) {
              note.classList.add('correct');
              note.classList.remove('incorrect');
              correct++;
            } else {
              note.classList.add('incorrect');
              note.classList.remove('correct');
            }
          }
        });
      } 
      // Process notes in hard mode
      else {
        elements.notes.forEach(note => {
          const parent = note.parentElement;
          if (parent && parent.classList.contains('box')) {
            totalPlaced++;
            const isCorrect = parent.getAttribute('data-label') === note.getAttribute('data-target');
            
            if (!isCorrect) {
              elements.notesArea.appendChild(note);
            } else {
              correct++;
            }
          }
        });
      }
      
      elements.scoreValue.textContent = `${correct}/${totalNotes}`;
      elements.scoreDisplay.style.display = 'block';
      
      // Update message based on score
      updateScoreMessage(elements, correct, totalNotes, totalPlaced);
    }
    
    // Update score message
    function updateScoreMessage(elements, correct, totalNotes, totalPlaced) {
      if (correct === totalNotes) {
        elements.message.textContent = "Perfect! You've correctly placed all items!";
        elements.message.className = "success";
        elements.hintButton.style.display = 'none';
      } else if (correct > 0) {
        if (hardModeEnabled) {
          const remainingToPlace = totalNotes - correct;
          elements.message.textContent = `${correct} correct. ${remainingToPlace} incorrect items returned to notes area.`;
        } else {
          elements.message.textContent = `Good effort! ${correct} correct, ${totalPlaced - correct} incorrect, ${totalNotes - totalPlaced} not placed.`;
          elements.hintButton.style.display = 'inline-block';
        }
        elements.message.className = "partial";
      } else {
        elements.message.textContent = "Try again! No correct answers yet.";
        elements.message.className = "empty";
        if (!hardModeEnabled) {
          elements.hintButton.style.display = 'inline-block';
        }
      }
      
      // In Hard Mode, never show hint button
      if (hardModeEnabled) {
        elements.hintButton.style.display = 'none';
      }
    }
    



/// Reset exercise
function resetExercise(tabId) {
  const elements = getTabElements(tabId);
  
  if (!elements.notes.length || !elements.notesArea || !elements.scoreDisplay) return;
  
  elements.notes.forEach(note => {
    note.classList.remove('correct', 'incorrect', 'show-hint');
    elements.notesArea.appendChild(note);
    
    // If we're in hard mode and this is the FP tab, maintain gray styling
    if (hardModeEnabled && tabId === 'fp') {
      note.style.borderColor = '#b2b2b2';
      note.style.backgroundColor = '#f2f2f2';
    } else {
      // For other cases, or when not in hard mode, clear styles
      note.style.borderColor = '';
      note.style.backgroundColor = '';
      
      // For FP tab in normal mode, restore SA/PA colors
      if (tabId === 'fp' && !hardModeEnabled) {
        const target = note.getAttribute('data-target');
        if (target.startsWith('SA')) {
          note.style.borderColor = '#0057B7';
          note.style.backgroundColor = '#F1F7FD';
        } else if (target.startsWith('PA')) {
          note.style.borderColor = '#E03C31';
          note.style.backgroundColor = '#FEF0EF';
        }
      }
    }
    
    // Ensure consistent sizing by removing any inline size styles
    note.style.width = '';
    note.style.height = '';
    note.style.margin = '';
    note.style.padding = '';
    note.style.fontSize = '';
  });
  
  // Rest of the function remains the same
  elements.boxes.forEach(box => {
    box.classList.remove('show-hint');
    const boxHintElement = box.querySelector('.box-hint');
    if (boxHintElement) {
      boxHintElement.remove();
    }
  });
  
  elements.scoreDisplay.style.display = 'none';
  elements.hintButton.style.display = 'none';
  shuffleNotes(tabId);
}



    // Initialize help popup
    function initializeHelpPopup() {
      const helpBtn = document.getElementById('help-btn');
      const helpPopup = document.getElementById('help-popup');
      const helpOverlay = document.getElementById('help-overlay');
      const closeBtn = document.getElementById('help-popup-close');
      const saInstructions = document.getElementById('sa-instructions');
      const paInstructions = document.getElementById('pa-instructions');
      const fpInstructions = document.getElementById('fp-instructions');
      
      // Show popup when help button is clicked
      helpBtn.addEventListener('click', function() {
        // Show appropriate instructions based on active tab
        const activeTab = document.querySelector('.tab.active').getAttribute('data-tab');
        toggleHelpContent(activeTab, saInstructions, paInstructions, fpInstructions);
        
        helpPopup.style.display = 'block';
        helpOverlay.style.display = 'block';
      });
      
      // Hide popup when close button is clicked
      closeBtn.addEventListener('click', closeHelpPopup);
      
      // Hide popup when overlay is clicked
      helpOverlay.addEventListener('click', closeHelpPopup);
      
      function closeHelpPopup() {
        helpPopup.style.display = 'none';
        helpOverlay.style.display = 'none';
      }
      
      function toggleHelpContent(activeTab, saInstructions, paInstructions, fpInstructions) {
        if (activeTab === 'sa') {
          saInstructions.style.display = 'block';
          paInstructions.style.display = 'none';
          fpInstructions.style.display = 'none';
          document.getElementById('help-popup-title').style.color = config.tabs.sa.color;
        } else if (activeTab === 'pa') {
          saInstructions.style.display = 'none';
          paInstructions.style.display = 'block';
          fpInstructions.style.display = 'none';
          document.getElementById('help-popup-title').style.color = config.tabs.pa.color;
        } else if (activeTab === 'fp') {
          saInstructions.style.display = 'none';
          paInstructions.style.display = 'none';
          fpInstructions.style.display = 'block';
          document.getElementById('help-popup-title').style.color = config.tabs.fp.color;
        }
      }
    }

// Show hints for boxes with incorrect notes
function showHints(tabId) {
  // Skip hints in Hard Mode
  if (hardModeEnabled) return;
  
  // Find all boxes that contain incorrect notes
  let boxes;
  if (tabId === 'fp') {
    // For FP tab, get both SA and PA boxes
    boxes = document.querySelectorAll('#fp-tab .box');
  } else {
    // For SA and PA tabs, use the prefix
    boxes = document.querySelectorAll(`.box[data-label^="${tabId.toUpperCase()}"]`);
  }
  
  // Remove any existing hint elements
  document.querySelectorAll('.box-hint').forEach(hint => hint.remove());
  
  boxes.forEach(box => {
    // Check if the box contains an incorrect note
    const incorrectNote = box.querySelector('.note.incorrect');
    if (!incorrectNote) return; // Skip boxes without incorrect notes
    
    // Get the box label for the hint
    const boxLabel = box.getAttribute('data-label');
    const boxPrefix = boxLabel.substring(0, 2); // Get SA or PA prefix
    const shortLabel = boxLabel.substring(3); // Remove the prefix
    
    // Determine which hint set to use
    const hintSet = tabId === 'fp' ? hints[boxPrefix.toLowerCase()] : hints[tabId];
    
    // Create a hint element
    const hintKey = shortLabel;
    const hintText = hintSet[hintKey] || `This box is for "${boxLabel}"`;
    const hintElement = document.createElement('div');
    hintElement.className = 'box-hint';
    hintElement.textContent = hintText;
    
    // Add the hint to the box
    box.appendChild(hintElement);
    
    // Show the hint
    setTimeout(() => {
      box.classList.add('show-hint');
    }, 100);
  });
  
  // Hide hints after 8 seconds
  setTimeout(() => {
    document.querySelectorAll('.box.show-hint').forEach(box => {
      box.classList.remove('show-hint');
    });
    setTimeout(() => {
      document.querySelectorAll('.box-hint').forEach(hint => hint.remove());
    }, 300);
  }, 8000);
}
  </script>
</body>
</html>